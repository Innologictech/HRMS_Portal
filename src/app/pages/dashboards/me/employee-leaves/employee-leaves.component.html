<div class="container-fluid dashboard-container p-4">

  <!-- Top Section -->
  <div class="d-flex align-items-center mb-4 border-bottom pb-2">
    <div class="fw-bold text-primary-custom border-bottom border-3 border-primary me-4 pb-2" style="cursor: pointer;">
      Summary
    </div>
  </div>

  <!-- Pending Requests Card -->
  <div class="card border-0 shadow-sm mb-4 rounded-3">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h6 class="fw-bold mb-3 text-dark">Pending leave requests</h6>
          <div class="d-flex align-items-center mt-3">
            <div class="me-3 p-2">
              <span class="fs-2">ðŸŽ‰</span>
            </div>
            <div>
              <h6 class="fw-bold mb-1 text-dark">Hurray! No pending leave requests</h6>
              <p class="text-muted small mb-0">Request leave on the right!</p>
            </div>
          </div>
        </div>

        <div class="text-end">
          <div class="mb-3">
            <button class="btn btn-outline-secondary btn-sm dropdown-toggle rounded-1 px-3" type="button">
              Jan 2025 - Dec 2025
            </button>
          </div>

          <!-- MAIN BUTTON -->
          <button class="btn btn-primary-custom px-4 mb-2" (click)="openRequest()">
            Request Leave
          </button>
          <br>

          <a class="text-decoration-none small text-primary-custom" style="cursor:pointer;">
            Leave Policy Explanation
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- My Leave Stats -->
  <h6 class="fw-bold mb-3 text-dark section-title">My Leave Stats</h6>
  <div class="row g-3 mb-4">
    
    <!-- Weekly Pattern -->
    <div class="col-md-6 col-lg-3">
      <div class="card h-100 border-0 shadow-sm rounded-3">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-bold small text-dark">Weekly Pattern</span>
            <i class="bi bi-info-circle text-muted small" title="Info"></i>
          </div>
          <div class="mt-auto text-center position-relative" style="min-height: 100px;">
            <div class="d-flex justify-content-between text-muted xx-small w-100">
              <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span>
              <span>Fri</span><span>Sat</span><span>Sun</span>
            </div>
            <div class="pt-4">
              <span class="text-muted small">No data to display.</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Consumed Leave -->
    <div class="col-md-6 col-lg-3">
      <div class="card h-100 border-0 shadow-sm rounded-3">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-bold small text-dark">Consumed Leave Types</span>
            <i class="bi bi-info-circle text-muted small"></i>
          </div>
          <div class="flex-grow-1 d-flex align-items-end justify-content-center pb-2">
            <span class="text-muted small">No data to display.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Monthly Stats -->
    <div class="col-md-6 col-lg-3">
      <div class="card h-100 border-0 shadow-sm rounded-3">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-bold small text-dark">Monthly Stats</span>
            <i class="bi bi-info-circle text-muted small"></i>
          </div>
          <div class="mt-auto position-relative" style="min-height: 100px;">
            <div class="d-flex justify-content-between text-muted xx-small w-100 border-top pt-2 mt-4">
              <span>Jun</span><span>Feb</span><span>Apr</span><span>Oct</span><span>Nov</span><span>Dec</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Leave Balances -->
  <h6 class="fw-bold mb-3 text-dark section-title">Leave Balances</h6>
  <div class="row g-3">
    <div class="col-md-6 col-lg-3" *ngFor="let balance of leaveBalances">
      <div class="card h-100 border-0 shadow-sm rounded-3">
        <div class="card-body d-flex flex-column p-0">
          
          <div class="p-3 flex-grow-1 d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <span class="fw-bold text-dark small">{{ balance.type }}</span>
              <a (click)="viewDetails(balance)" class="text-decoration-none x-small text-primary-custom" style="cursor:pointer;">View details</a>
            </div>

            <div class="flex-grow-1 d-flex align-items-center justify-content-center" style="min-height: 120px;">
              <div *ngIf="!balance.dataPresent" class="text-muted small">
                No data to display.
              </div>

              <div *ngIf="balance.dataPresent" class="position-relative">
                <div class="gauge-container" [style.--percentage]="balance.percentage">
                  <div class="gauge-inner">
                    <div class="text-center lh-1">
                      <span class="d-block fw-bold text-primary-custom mb-1" style="font-size: 1rem;">
                        {{ balance.availableStr }}
                      </span>
                      <span class="text-muted xx-small">Available</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="border-top">
            <div class="row g-0">
              <div class="col-6 p-2 border-end border-bottom">
                <div class="text-secondary text-uppercase xx-small fw-bold">AVAILABLE</div>
                <div class="small text-dark mt-1 fw-bold">
                  {{ balance.availableStr || balance.available + ' day' }}
                </div>
              </div>

              <div class="col-6 p-2 border-bottom">
                <div class="text-secondary text-uppercase xx-small fw-bold">CONSUMED</div>
                <div class="small text-dark mt-1 fw-bold">{{ balance.consumed }} day</div>
              </div>

              <div class="col-6 p-2 border-end">
                <div class="text-secondary text-uppercase xx-small fw-bold">ACCRUED SO FAR</div>
                <div class="small text-dark mt-1 fw-bold">{{ balance.accrualSoFar }}</div>
              </div>

              <div class="col-6 p-2">
                <div class="text-secondary text-uppercase xx-small fw-bold">ANNUAL QUOTA</div>
                <div class="small text-dark mt-1 fw-bold">{{ balance.annualQuota }}</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Drawer Overlay -->
  <div class="drawer-overlay" *ngIf="showRequest" (click)="closeRequest()"></div>

  <!-- Drawer -->
  <div class="drawer" [class.open]="showRequest" (click)="$event.stopPropagation()">

    <div class="drawer-header">
      <h5>Request Leave</h5>
      <button class="close-btn" (click)="closeRequest()">&times;</button>
    </div>

    <div class="drawer-body">
      <!-- Date Range -->
      <div class="d-flex justify-content-between gap-2 mb-4">
        <div class="date-box">
          <label>From</label>
         <input
          type="text"
          class="form-control"
          bsDatepicker
          [bsConfig]="bsConfig"
          placeholder="Select date">
        </div>

        <div class="date-days">{{ leave.days }} days</div>

        <div class="date-box">
          <label>To</label>
          <!-- <input type="date" [(ngModel)]="leave.to"> -->
           <input
          type="text"
          class="form-control"
          bsDatepicker
          [bsConfig]="bsConfig"
          placeholder="Select date">
        </div>
      </div>

      <!-- Type -->
      <label class="fw-semibold">Select type of leave you want to apply</label>
      <select class="form-select mb-3" [(ngModel)]="leave.type">
        <option value="">Select</option>
        <option value="CL">Casual Leave</option>
        <option value="EL">Earned Leave</option>
        <option value="SL">Sick Leave</option>
      </select>

      <!-- Note -->
      <label class="fw-semibold">Note</label>
      <textarea class="form-control mb-3" rows="3" placeholder="Type here" [(ngModel)]="leave.note"></textarea>
      
      <!-- Document -->
 <label class="fw-semibold">Supporting Document</label>

<div class="file-upload-wrapper">
  <input
    type="file"
    class="form-control"
    #fileInput
    (change)="onFileSelected($event)"
  />

  <!-- Cancel icon -->
  <span
    *ngIf="selectedFile"
    class="cancel-icon"
    (click)="cancelFile(fileInput)"
  >
    Ã—
  </span>
</div>

<!-- Show selected file name -->
<div *ngIf="selectedFile" class="mt-1 text-muted">
  {{ selectedFile.name }}
</div>


      <!-- Notify -->
      <label class="fw-semibold">Notify</label>
      <input type="text" class="form-control" placeholder="Search employee" [(ngModel)]="leave.notify">
    </div>

    <div class="drawer-footer">
      <button class="btn btn-light" (click)="closeRequest()">Cancel</button>
      <button class="btn btn-primary-custom" (click)="submitRequest()">Request</button>
    </div>

  </div>

</div>